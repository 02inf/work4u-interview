#!/usr/bin/env python3
"""
æ•°æ®åº“è¿ç§»è„šæœ¬
ç”¨äºå°†ç°æœ‰æ•°æ®è¿ç§»åˆ°SQLiteæ•°æ®åº“
"""

import sys
import os
from datetime import datetime

# æ·»åŠ å½“å‰ç›®å½•åˆ°Pythonè·¯å¾„
sys.path.append(os.path.dirname(__file__))

from database import db_manager

def create_sample_data():
    """åˆ›å»ºç¤ºä¾‹æ•°æ®ç”¨äºæµ‹è¯•"""
    sample_meetings = [
        {
            'id': f'meeting_sample_1_{datetime.now().strftime("%Y%m%d_%H%M%S")}',
            'title': 'é¡¹ç›®å¯åŠ¨ä¼šè®®',
            'date': '2024-01-15 10:00:00',
            'duration': 'çº¦60åˆ†é’Ÿ',
            'transcript': '''é¡¹ç›®ç»ç†: å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬å¬å¼€é¡¹ç›®å¯åŠ¨ä¼šè®®ã€‚
æŠ€æœ¯è´Ÿè´£äºº: æˆ‘æ¥ä»‹ç»ä¸€ä¸‹æŠ€æœ¯æ¶æ„æ–¹æ¡ˆã€‚
äº§å“ç»ç†: æˆ‘ä»¬éœ€è¦ç¡®è®¤äº§å“éœ€æ±‚å’Œæ—¶é—´èŠ‚ç‚¹ã€‚
é¡¹ç›®ç»ç†: å¥½çš„ï¼Œæˆ‘ä»¬å…ˆè®¨è®ºæŠ€æœ¯æ–¹æ¡ˆï¼Œç„¶åç¡®è®¤æ—¶é—´å®‰æ’ã€‚
æŠ€æœ¯è´Ÿè´£äºº: æˆ‘ä»¬è®¡åˆ’ä½¿ç”¨Reactå’ŒFastAPIæŠ€æœ¯æ ˆã€‚
äº§å“ç»ç†: è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚
é¡¹ç›®ç»ç†: é‚£æˆ‘ä»¬ç¡®å®šä¸‹æ¥ï¼Œä¸‹å‘¨å¼€å§‹å¼€å‘å·¥ä½œã€‚''',
            'participants': ['é¡¹ç›®ç»ç†', 'æŠ€æœ¯è´Ÿè´£äºº', 'äº§å“ç»ç†'],
            'key_points': [
                'ç¡®å®šäº†é¡¹ç›®çš„æŠ€æœ¯æ¶æ„æ–¹æ¡ˆ',
                'æ˜ç¡®äº†å„å›¢é˜Ÿæˆå‘˜çš„èŒè´£åˆ†å·¥',
                'åˆ¶å®šäº†é¡¹ç›®å¼€å‘æ—¶é—´è®¡åˆ’'
            ],
            'decisions': [
                'é‡‡ç”¨React + FastAPIæŠ€æœ¯æ ˆ',
                'ä¸‹å‘¨æ­£å¼å¼€å§‹å¼€å‘å·¥ä½œ',
                'æ¯å‘¨ä¸¾è¡Œä¸€æ¬¡è¿›åº¦åŒæ­¥ä¼šè®®'
            ],
            'action_items': [
                'æŠ€æœ¯è´Ÿè´£äººå‡†å¤‡è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£',
                'äº§å“ç»ç†æ•´ç†å®Œæ•´çš„éœ€æ±‚æ–‡æ¡£',
                'é¡¹ç›®ç»ç†åˆ¶å®šè¯¦ç»†çš„é¡¹ç›®è®¡åˆ’'
            ],
            'next_steps': [
                'ä¸‹å‘¨ä¸€æäº¤æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£',
                'ä¸‹å‘¨ä¸‰å®Œæˆéœ€æ±‚ç¡®è®¤',
                'ä¸‹å‘¨äº”å¼€å§‹ç¬¬ä¸€é˜¶æ®µå¼€å‘'
            ]
        },
        {
            'id': f'meeting_sample_2_{datetime.now().strftime("%Y%m%d_%H%M%S")}',
            'title': 'æŠ€æœ¯è¯„å®¡ä¼šè®®',
            'date': '2024-01-20 14:00:00',
            'duration': 'çº¦45åˆ†é’Ÿ',
            'transcript': '''æ¶æ„å¸ˆ: ä»Šå¤©æˆ‘ä»¬è¯„å®¡å‰ç«¯å’Œåç«¯çš„æŠ€æœ¯æ–¹æ¡ˆã€‚
å‰ç«¯å¼€å‘: æˆ‘ä»¬é€‰æ‹©äº†React + TypeScriptçš„ç»„åˆã€‚
åç«¯å¼€å‘: åç«¯ä½¿ç”¨FastAPI + SQLiteæ•°æ®åº“ã€‚
æ¶æ„å¸ˆ: è¿™ä¸ªæŠ€æœ¯é€‰å‹å¾ˆåˆç†ï¼Œç¬¦åˆé¡¹ç›®éœ€æ±‚ã€‚
å‰ç«¯å¼€å‘: æˆ‘ä»¬è¿˜é›†æˆäº†Viteä½œä¸ºæ„å»ºå·¥å…·ã€‚
åç«¯å¼€å‘: æ•°æ®åº“è®¾è®¡å·²ç»å®Œæˆï¼Œæ”¯æŒä¼šè®®è®°å½•çš„å­˜å‚¨ã€‚
æ¶æ„å¸ˆ: å¾ˆå¥½ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å®æ–½äº†ã€‚''',
            'participants': ['æ¶æ„å¸ˆ', 'å‰ç«¯å¼€å‘', 'åç«¯å¼€å‘'],
            'key_points': [
                'ç¡®è®¤äº†å‰ç«¯æŠ€æœ¯æ ˆï¼šReact + TypeScript + Vite',
                'ç¡®è®¤äº†åç«¯æŠ€æœ¯æ ˆï¼šFastAPI + SQLite',
                'å®Œæˆäº†æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆè¯„å®¡'
            ],
            'decisions': [
                'æŠ€æœ¯æ–¹æ¡ˆé€šè¿‡è¯„å®¡',
                'å¼€å§‹è¿›å…¥å¼€å‘å®æ–½é˜¶æ®µ',
                'å»ºç«‹ä»£ç å®¡æŸ¥æµç¨‹'
            ],
            'action_items': [
                'å‰ç«¯å¼€å‘æ­å»ºé¡¹ç›®è„šæ‰‹æ¶',
                'åç«¯å¼€å‘å®ç°APIæ¥å£',
                'æ¶æ„å¸ˆåˆ¶å®šä»£ç è§„èŒƒæ–‡æ¡£'
            ],
            'next_steps': [
                'æœ¬å‘¨å®Œæˆé¡¹ç›®åˆå§‹åŒ–',
                'ä¸‹å‘¨å¼€å§‹æ ¸å¿ƒåŠŸèƒ½å¼€å‘',
                'å»ºç«‹æŒç»­é›†æˆæµç¨‹'
            ]
        }
    ]
    
    return sample_meetings

def migrate_sample_data():
    """è¿ç§»ç¤ºä¾‹æ•°æ®åˆ°æ•°æ®åº“"""
    print("ğŸš€ å¼€å§‹æ•°æ®åº“è¿ç§»...")
    
    # è·å–ç¤ºä¾‹æ•°æ®
    sample_meetings = create_sample_data()
    
    success_count = 0
    for meeting in sample_meetings:
        if db_manager.save_meeting(meeting):
            print(f"âœ… æˆåŠŸä¿å­˜ä¼šè®®: {meeting['title']}")
            success_count += 1
        else:
            print(f"âŒ ä¿å­˜å¤±è´¥: {meeting['title']}")
    
    print(f"\nğŸ“Š è¿ç§»å®Œæˆ: {success_count}/{len(sample_meetings)} æ¡è®°å½•æˆåŠŸä¿å­˜")
    
    # æ˜¾ç¤ºæ•°æ®åº“ç»Ÿè®¡
    stats = db_manager.get_database_stats()
    print(f"\nğŸ“ˆ æ•°æ®åº“ç»Ÿè®¡:")
    print(f"   - ä¼šè®®è®°å½•: {stats.get('meetings', 0)} æ¡")
    print(f"   - è½¬å½•è®°å½•: {stats.get('transcripts', 0)} æ¡")
    print(f"   - æ‘˜è¦è®°å½•: {stats.get('summaries', 0)} æ¡")
    print(f"   - æ•°æ®åº“è·¯å¾„: {stats.get('database_path', 'N/A')}")

def main():
    """ä¸»å‡½æ•°"""
    print("=" * 50)
    print("ğŸ“‹ ä¼šè®®æ‘˜è¦ç³»ç»Ÿ - æ•°æ®åº“è¿ç§»å·¥å…·")
    print("=" * 50)
    
    try:
        # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
        stats = db_manager.get_database_stats()
        print(f"\nğŸ“Š å½“å‰æ•°æ®åº“çŠ¶æ€:")
        print(f"   - ä¼šè®®è®°å½•: {stats.get('meetings', 0)} æ¡")
        print(f"   - æ•°æ®åº“è·¯å¾„: {stats.get('database_path', 'N/A')}")
        
        # è¯¢é—®æ˜¯å¦è¦æ·»åŠ ç¤ºä¾‹æ•°æ®
        if stats.get('meetings', 0) == 0:
            print("\nğŸ’¡ æ£€æµ‹åˆ°æ•°æ®åº“ä¸ºç©ºï¼Œæ˜¯å¦è¦æ·»åŠ ç¤ºä¾‹æ•°æ®ï¼Ÿ")
            choice = input("è¾“å…¥ 'y' æ·»åŠ ç¤ºä¾‹æ•°æ®ï¼Œå…¶ä»–é”®è·³è¿‡: ").lower().strip()
            
            if choice == 'y':
                migrate_sample_data()
            else:
                print("â­ï¸  è·³è¿‡ç¤ºä¾‹æ•°æ®æ·»åŠ ")
        else:
            print("\nâœ… æ•°æ®åº“å·²åŒ…å«æ•°æ®ï¼Œæ— éœ€è¿ç§»")
            
    except Exception as e:
        print(f"âŒ è¿ç§»è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {e}")
        return 1
    
    print("\nğŸ‰ è¿ç§»å·¥å…·æ‰§è¡Œå®Œæˆï¼")
    return 0

if __name__ == "__main__":
    exit(main())